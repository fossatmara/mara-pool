apiVersion: v1
kind: Service
metadata:
  name: translator-sv2
  namespace: sv2-mining
  labels:
    app.kubernetes.io/name: translator-sv2
    app.kubernetes.io/component: translator
    app.kubernetes.io/part-of: stratum-v2
  annotations:
    # Cloud provider annotations for LoadBalancer configuration
    # AWS NLB for TCP traffic
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    # service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
    # 
    # Use monitoring port for NLB health checks (not the SV1 mining port)
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-port: "9092"
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-path: "/api/v1/health"
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol: "HTTP"
    # 
    # GCP
    # cloud.google.com/load-balancer-type: "External"
spec:
  # LoadBalancer exposes the service externally for SV1 miners
  type: LoadBalancer
  # externalTrafficPolicy: Local preserves client IP (useful for logging)
  # but may cause uneven load distribution
  externalTrafficPolicy: Cluster
  selector:
    app.kubernetes.io/name: translator-sv2
  ports:
    # SV1 Stratum port for miners
    - name: sv1
      port: 34255
      targetPort: 34255
      protocol: TCP
    # HTTP Monitoring API (v0.2.0)
    # Consider: expose via separate ClusterIP service for internal access only
    - name: monitoring
      port: 9092
      targetPort: 9092
      protocol: TCP
